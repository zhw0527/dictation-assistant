<!--pages/correction/correction.wxml-->
<view class="container">
  <!-- æˆç»©æ¦‚è§ˆ -->
  <view class="summary-card">
    <view class="grade-circle {{report.summary.grade}}">
      <text class="grade-text">{{report.summary.grade}}</text>
      <text class="accuracy-text">{{report.summary.accuracy}}%</text>
    </view>
    
    <view class="summary-stats">
      <view class="stat-item">
        <text class="stat-value">{{report.summary.total}}</text>
        <text class="stat-label">æ€»é¢˜æ•°</text>
      </view>
      <view class="stat-item correct">
        <text class="stat-value">{{report.summary.correct}}</text>
        <text class="stat-label">æ­£ç¡®</text>
      </view>
      <view class="stat-item wrong">
        <text class="stat-value">{{report.summary.wrong}}</text>
        <text class="stat-label">é”™è¯¯</text>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯ç±»å‹ç»Ÿè®¡ -->
  <view class="error-types" wx:if="{{report.summary.wrong > 0}}">
    <view class="section-title">é”™è¯¯ç±»å‹åˆ†æ</view>
    <view class="error-type-list">
      <view class="error-type-item" wx:for="{{report.errorTypes}}" wx:key="index" wx:for-item="type" wx:for-index="key">
        <text class="error-type-name">{{key}}</text>
        <text class="error-type-count">{{type}} é¢˜</text>
      </view>
    </view>
  </view>

  <!-- é”™é¢˜åˆ—è¡¨ -->
  <view class="wrong-answers" wx:if="{{report.summary.wrong > 0}}">
    <view class="section-title">
      <text>é”™é¢˜æœ¬</text>
      <text class="wrong-count">ï¼ˆ{{report.summary.wrong}} é¢˜ï¼‰</text>
    </view>
    
    <view class="wrong-answer-list">
      <view 
        class="wrong-answer-item" 
        wx:for="{{report.wrongAnswers}}" 
        wx:key="index"
        bindtap="viewWrongAnswer"
        data-index="{{index}}"
      >
        <view class="answer-header">
          <text class="answer-number">ç¬¬ {{item.index}} é¢˜</text>
          <text class="view-detail">æŸ¥çœ‹è¯¦æƒ… ></text>
        </view>
        <view class="answer-content">
          <view class="answer-row">
            <text class="answer-label">æ ‡å‡†ç­”æ¡ˆï¼š</text>
            <text class="answer-text correct-text">{{item.standardAnswer}}</text>
          </view>
          <view class="answer-row">
            <text class="answer-label">ä½ çš„ç­”æ¡ˆï¼š</text>
            <text class="answer-text wrong-text">{{item.userAnswer || 'æœªä½œç­”'}}</text>
          </view>
        </view>
        <view class="answer-tip" wx:if="{{item.analysis && item.analysis.suggestion}}">
          ğŸ’¡ {{item.analysis.suggestion}}
        </view>
      </view>
    </view>
  </view>

  <!-- å…¨å¯¹çš„é¼“åŠ± -->
  <view class="perfect-score" wx:if="{{report.summary.wrong === 0}}">
    <image class="perfect-icon" src="/images/perfect.png" mode="aspectFit"></image>
    <text class="perfect-text">å¤ªæ£’äº†ï¼å…¨éƒ¨æ­£ç¡®ï¼</text>
    <text class="perfect-desc">ç»§ç»­ä¿æŒï¼Œä½ æ˜¯æœ€æ£’çš„ï¼</text>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn-action" bindtap="retryWrongAnswers" wx:if="{{report.summary.wrong > 0}}">
      ğŸ“ é‡åšé”™é¢˜
    </button>
    <button class="btn-action btn-primary" bindtap="backToHome">
      ğŸ  è¿”å›é¦–é¡µ
    </button>
  </view>
</view>
